<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#f5efe0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="SLF">
<title>Stadt Land Fluss</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@300;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #f5efe0; --bg2: #fdf6e8; --ink: #3a2e1e; --pink: #c0334d;
    --green: #7dc45a; --lilac: #c46fa0; --yellow: #f0b93a; --sky: #e8507a; --peach: #d94f72;
  }
  body {
    background: var(--bg); color: var(--ink); font-family: 'DM Mono', monospace;
    min-height: 100dvh; display: flex; flex-direction: column;
    align-items: center; justify-content: center; overflow: hidden;
    user-select: none; position: relative; -webkit-tap-highlight-color: transparent;
    /* Verhindert Pull-to-Refresh und Scrolling auf iOS */
    touch-action: none; 
  }
  .blob { position: fixed; border-radius: 50%; filter: blur(70px); opacity: 0.22; pointer-events: none; z-index: 0; }
  .blob-1 { width: 380px; height: 380px; background: var(--pink); top: -80px; left: -80px; }
  .blob-2 { width: 320px; height: 320px; background: var(--yellow); bottom: -60px; right: -60px; }
  .petal { position: fixed; pointer-events: none; z-index: 0; animation: drift linear infinite; opacity: 0.55; }
  @keyframes drift {
    0% { transform: translateY(-40px) rotate(0deg); opacity: 0; }
    100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
  }
  .container { position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center; pointer-events: none; }
  .title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(1.2rem, 5vw, 1.8rem); letter-spacing: 0.4em; opacity: 0.45; margin-bottom: 2rem; text-transform: uppercase; }
  .letter-display { position: relative; width: min(320px, 82vw); height: min(320px, 82vw); display: flex; align-items: center; justify-content: center; }
  .card { position: absolute; inset: 20px; border-radius: 50%; background: var(--bg2); box-shadow: 0 8px 32px rgba(180,120,80,0.12); border: 2px solid rgba(255,255,255,0.7); z-index: 1; }
  .ring { position: absolute; inset: 0; border-radius: 50%; border: 4px dashed rgba(192, 51, 77, 0.25); animation: rotate 18s linear infinite; }
  .running .ring { border-color: rgba(192, 51, 77, 0.55); animation-duration: 2s; }
  @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .letter { font-family: 'Bebas Neue', sans-serif; font-size: min(13rem, 33vw); line-height: 1; color: var(--ink); position: relative; z-index: 2; }
  .letter.flash { animation: flash 0.08s linear; }
  @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
  .stopped .letter { animation: colorCycle 2s ease-in-out infinite; }
  @keyframes colorCycle { 0%, 100% { color: var(--pink); } 50% { color: var(--green); } }
  .timer-svg { position: absolute; inset: -12px; width: calc(100% + 24px); height: calc(100% + 24px); transform: rotate(-90deg); z-index: 3; opacity: 0; transition: opacity 0.3s; }
  .running .timer-svg { opacity: 1; }
  .timer-track { fill: none; stroke: rgba(58,46,30,0.08); stroke-width: 5; }
  .timer-progress { fill: none; stroke: var(--green); stroke-width: 5; stroke-linecap: round; }
  .countdown { position: absolute; bottom: 14px; right: 16px; font-size: 0.75rem; color: var(--pink); opacity: 0; z-index: 4; font-weight: 500; }
  .running .countdown { opacity: 0.85; }
  .status { margin-top: 1.2rem; font-size: 0.7rem; letter-spacing: 0.25em; text-transform: uppercase; height: 1em; color: var(--green); opacity: 0; }
  .stopped .status { opacity: 0.8; }
  .hint { margin-top: 0.8rem; font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; opacity: 0.35; text-align: center; }
  .hint .key { display: inline-block; border: 1.5px solid currentColor; padding: 1px 6px 2px; border-radius: 4px; font-size: 0.65rem; margin-right: 4px; }
  
  /* Overlay Button - KRITISCH FÃœR IOS */
  #interaction-layer {
    position: fixed; inset: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.001); /* Hit-test fix */
    z-index: 9999; cursor: pointer; border: none; outline: none;
    -webkit-tap-highlight-color: transparent;
  }

  #installBanner, #iosBanner { display: none; position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: var(--bg2); border: 1.5px solid rgba(192,51,77,0.25); border-radius: 14px; padding: 12px 18px; box-shadow: 0 4px 20px rgba(192,51,77,0.12); z-index: 10000; font-size: 0.72rem; color: var(--ink); }
  #installBanner.show { display: flex; align-items: center; gap: 12px; }
  #iosBanner.show { display: block; text-align: center; line-height: 1.7; }
  button.action-btn { background: var(--pink); color: #fff; border: none; border-radius: 8px; padding: 6px 14px; font-family: 'DM Mono', monospace; font-size: 0.7rem; cursor: pointer; text-transform: uppercase; }
</style>
</head>
<body>

<div class="blob blob-1"></div>
<div class="blob blob-2"></div>

<button id="interaction-layer" aria-label="Starten oder Stoppen"></button>

<div class="container" id="container">
  <div class="title">Stadt Â· Land Â· Fluss</div>
  <div class="letter-display" id="display">
    <div class="ring"></div>
    <div class="card"></div>
    <svg class="timer-svg" viewBox="0 0 344 344">
      <circle class="timer-track" cx="172" cy="172" r="168"/>
      <circle class="timer-progress" id="timerArc" cx="172" cy="172" r="168"/>
    </svg>
    <div class="letter" id="letter">?</div>
    <div class="countdown" id="countdown">10s</div>
  </div>
  <div class="status" id="status">ðŸŒ¸ Buchstabe gefunden!</div>
  <div class="hint" id="hint"></div>
</div>

<div id="installBanner">
  ðŸŒ¸ Als App installieren <button id="installBtn" class="action-btn">Installieren</button>
</div>
<div id="iosBanner">
  <strong>Zum Homebildschirm:</strong> <br> Teilen (â–¡â†‘) -> Zum Home-Bildschirm ðŸŒ¸ <br>
  <button class="action-btn" id="iosClose" style="margin-top:8px">OK</button>
</div>

<script>
  // Game Logic
  const LETTERS = 'ABCDEFGHIJKLMNOPRSTUVWZ'.split('');
  const MAX_TIME = 10000;
  const CIRCUMFERENCE = 2 * Math.PI * 168;
  let running = false, interval = null, timerTimeout = null, timerRaf = null, startTime = null, currentLetter = '?';
  let audioCtx = null;

  const letterEl = document.getElementById('letter'), display = document.getElementById('display'), 
        container = document.getElementById('container'), hint = document.getElementById('hint'), 
        timerArc = document.getElementById('timerArc'), countdownEl = document.getElementById('countdown'),
        interactionLayer = document.getElementById('interaction-layer');

  timerArc.style.strokeDasharray = CIRCUMFERENCE;

  function unlockAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const b = audioCtx.createBuffer(1, 1, 22050), s = audioCtx.createBufferSource();
    s.buffer = b; s.connect(audioCtx.destination); s.start(0);
  }

  function updateArc() {
    if (!running) return;
    const elapsed = Date.now() - startTime, progress = Math.min(elapsed / MAX_TIME, 1);
    timerArc.style.strokeDashoffset = CIRCUMFERENCE * progress;
    timerArc.style.stroke = progress < 0.5 ? '#7dc45a' : progress < 0.75 ? '#f0b93a' : '#c0334d';
    countdownEl.textContent = Math.max(0, Math.ceil((MAX_TIME - elapsed) / 1000)) + 's';
    timerRaf = requestAnimationFrame(updateArc);
  }

  function start() {
    running = true; startTime = Date.now();
    display.classList.add('running'); display.classList.remove('stopped'); container.classList.remove('stopped');
    updateHint('running'); timerArc.style.strokeDashoffset = 0; updateArc();
    timerTimeout = setTimeout(stop, MAX_TIME);
    interval = setInterval(() => {
      const next = LETTERS[Math.floor(Math.random() * LETTERS.length)];
      if (next !== currentLetter) { 
        currentLetter = next; letterEl.textContent = currentLetter; 
        letterEl.classList.remove('flash'); void letterEl.offsetWidth; letterEl.classList.add('flash'); 
      }
    }, 80);
  }

  function stop() {
    running = false; clearInterval(interval); clearTimeout(timerTimeout); cancelAnimationFrame(timerRaf);
    display.classList.remove('running'); display.classList.add('stopped'); container.classList.add('stopped');
    updateHint('stopped'); beep();
  }

  function beep() {
    try {
      const t = audioCtx.currentTime;
      [523, 659, 783].forEach((f, i) => {
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination); o.type = 'triangle';
        o.frequency.setValueAtTime(f, t + i*0.1); g.gain.setValueAtTime(0, t + i*0.1);
        g.gain.linearRampToValueAtTime(0.2, t + i*0.1 + 0.02); g.gain.exponentialRampToValueAtTime(0.001, t + i*0.1 + 0.1);
        o.start(t + i*0.1); o.stop(t + i*0.1 + 0.2);
      });
    } catch(e) {}
  }

  function updateHint(state) {
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const label = isMobile ? '<span class="key">TAP</span> ' : '<span class="key">SPACE</span> ';
    const actions = { idle: 'Starten', running: 'Stoppen', stopped: 'Nochmal' };
    hint.innerHTML = label + (actions[state] || 'Starten');
  }

  // EVENT HANDLING
  const handleInteraction = (e) => {
    if (e) e.preventDefault();
    unlockAudio();
    running ? stop() : start();
  };

  // iOS/Touch Fix: touchstart ist fÃ¼r Audio-Unlock auf Safari am sichersten
  interactionLayer.addEventListener('touchstart', handleInteraction, { passive: false });
  // Fallback fÃ¼r Desktop
  interactionLayer.addEventListener('click', (e) => {
    if (window.ontouchstart === undefined) handleInteraction(e);
  });
  window.addEventListener('keydown', e => { if (e.code === 'Space') handleInteraction(e); });

  updateHint('idle');

  // PWA & iOS Banners
  if (/iPhone|iPad|iPod/.test(navigator.userAgent) && !window.navigator.standalone) {
    setTimeout(() => document.getElementById('iosBanner').classList.add('show'), 2000);
  }
  document.getElementById('iosClose').onclick = () => document.getElementById('iosBanner').style.display='none';
</script>
</body>
</html>
